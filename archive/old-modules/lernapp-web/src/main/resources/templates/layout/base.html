<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Fachinformatiker Lernapp - Die moderne Lernplattform für IT-Azubis">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">Fachinformatiker Lernapp</title>
    
    <!-- Tailwind CSS - Production Ready -->
    <link rel="stylesheet" th:href="@{/css/tailwind.min.css}">
    <!-- Fallback für Development -->
    <style>
        /* Basic Tailwind-like utility classes for fallback */
        .bg-gray-50 { background-color: #f9fafb; }
        .text-gray-900 { color: #111827; }
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .container { width: 100%; max-width: 1200px; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
    </style>
    
    <!-- HTMX -->
    <script src="/webjars/htmx.org/1.9.10/dist/htmx.min.js"></script>
    
    <!-- Alpine.js -->
    <script src="/webjars/alpinejs/3.13.3/dist/cdn.min.js" defer></script>
    
    <!-- Auth Management -->
    <script src="/js/auth.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/app.css}">
    
    <!-- Dark Mode Configuration -->
    <script>
        // Dark mode initialization
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    
    <!-- Additional head content from child templates -->
    <th:block layout:fragment="head"></th:block>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen flex flex-col">
    
    <!-- Navigation Header -->
    <header th:replace="~{fragments/header :: header}"></header>
    
    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- Flash Messages -->
        <div th:if="${successMessage}" class="mb-4">
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
                <span th:text="${successMessage}"></span>
                <button onclick="this.parentElement.style.display='none'" class="absolute top-0 bottom-0 right-0 px-4 py-3">
                    <svg class="fill-current h-6 w-6 text-green-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <title>Close</title>
                        <path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div th:if="${errorMessage}" class="mb-4">
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                <span th:text="${errorMessage}"></span>
                <button onclick="this.parentElement.style.display='none'" class="absolute top-0 bottom-0 right-0 px-4 py-3">
                    <svg class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <title>Close</title>
                        <path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Page Content -->
        <div layout:fragment="content">
            <!-- Content from child templates will be inserted here -->
        </div>
    </main>
    
    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>
    
    <!-- HTMX Configuration -->
    <script>
        document.body.addEventListener('htmx:configRequest', (event) => {
            // Add JWT token to HTMX requests if available
            const token = localStorage.getItem('jwt_token');
            if (token) {
                event.detail.headers['Authorization'] = 'Bearer ' + token;
            }
        });
        
        // Handle HTMX errors globally
        document.body.addEventListener('htmx:responseError', (event) => {
            if (event.detail.xhr.status === 401) {
                // Redirect to login on unauthorized
                window.location.href = '/login';
            }
        });
    </script>
    
    <!-- Additional scripts from child templates -->
    <th:block layout:fragment="scripts"></th:block>
</body>
</html>