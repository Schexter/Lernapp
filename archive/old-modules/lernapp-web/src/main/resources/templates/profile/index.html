<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/base}">

<head>
    <title layout:fragment="title">Mein Profil</title>
    <th:block layout:fragment="head">
        <!-- Chart.js für Statistiken -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- File Upload Styling -->
        <style>
            .file-upload-area {
                border: 2px dashed #e5e7eb;
                transition: all 0.3s ease;
            }
            .file-upload-area:hover {
                border-color: #3b82f6;
                background-color: #f8fafc;
            }
            .file-upload-area.dragover {
                border-color: #3b82f6;
                background-color: #eff6ff;
            }
        </style>
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <!-- Profile Header -->
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg mb-6">
            <div class="px-4 py-5 sm:px-6">
                <div class="flex items-center space-x-6">
                    <!-- Profile Picture -->
                    <div class="flex-shrink-0" x-data="profilePicture()">
                        <div class="relative">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold">
                                <span sec:authorize="isAuthenticated()" th:text="${#strings.substring(#authentication.name, 0, 2).toUpperCase()}">AB</span>
                                <span sec:authorize="!isAuthenticated()">?</span>
                            </div>
                            <button @click="$refs.fileInput.click()" 
                                    class="absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                            <input type="file" x-ref="fileInput" @change="handleFileUpload($event)" accept="image/*" class="hidden">
                        </div>
                    </div>

                    <!-- User Info -->
                    <div class="flex-1">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white" sec:authorize="isAuthenticated()" th:text="${#authentication.name}">Username</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400" th:text="${userProfile?.email}">user@example.com</p>
                        <div class="mt-2 flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                            <span class="flex items-center">
                                <svg class="mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                Mitglied seit <span th:text="${#temporals.format(userProfile?.createdAt, 'MMM yyyy')}">Jan 2024</span>
                            </span>
                            <span class="flex items-center">
                                <svg class="mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span th:text="${userProfile?.location ?: 'Nicht angegeben'}">Deutschland</span>
                            </span>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="hidden sm:flex space-x-8">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" th:text="${userStats?.totalAnswers ?: 0}">142</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Beantwortete Fragen</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" th:text="${userStats?.correctAnswers ?: 0}">89</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Richtige Antworten</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900 dark:text-white" th:text="${userStats?.currentStreak ?: 0}">7</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Tage Streak</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Personal Information -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg" x-data="profileForm()">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Persönliche Informationen</h3>
                        
                        <form @submit.prevent="saveProfile()" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Vorname</label>
                                    <input type="text" x-model="profile.firstName" 
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                           th:value="${userProfile?.firstName}">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nachname</label>
                                    <input type="text" x-model="profile.lastName" 
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                           th:value="${userProfile?.lastName}">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">E-Mail-Adresse</label>
                                <input type="email" x-model="profile.email" 
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                       th:value="${userProfile?.email}">
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Telefonnummer</label>
                                    <input type="tel" x-model="profile.phone" 
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                           th:value="${userProfile?.phone}">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Geburtsdatum</label>
                                    <input type="date" x-model="profile.birthDate" 
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                           th:value="${userProfile?.birthDate}">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Standort</label>
                                <input type="text" x-model="profile.location" 
                                       placeholder="Stadt, Land"
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                       th:value="${userProfile?.location}">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Über mich</label>
                                <textarea x-model="profile.bio" rows="4" 
                                          placeholder="Erzählen Sie etwas über sich..."
                                          class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"
                                          th:text="${userProfile?.bio}"></textarea>
                            </div>

                            <div class="flex justify-end space-x-3">
                                <button type="button" 
                                        class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                    Abbrechen
                                </button>
                                <button type="submit" 
                                        class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <svg x-show="saving" class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span x-text="saving ? 'Speichern...' : 'Speichern'">Speichern</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Learning Progress -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Lernfortschritt</h3>
                        
                        <!-- Progress Charts -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Antwortgenauigkeit</h4>
                                <canvas id="accuracyChart" width="200" height="200"></canvas>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Fortschritt nach Themen</h4>
                                <canvas id="topicProgressChart" width="200" height="200"></canvas>
                            </div>
                        </div>

                        <!-- Topic Progress Bars -->
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-700 dark:text-gray-300">Java Grundlagen</span>
                                    <span class="text-gray-500 dark:text-gray-400">85%</span>
                                </div>
                                <div class="mt-1 relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                            <div class="bg-blue-600 h-2 rounded-full" style="width: 85%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-700 dark:text-gray-300">Datenbanken</span>
                                    <span class="text-gray-500 dark:text-gray-400">67%</span>
                                </div>
                                <div class="mt-1 relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                            <div class="bg-green-600 h-2 rounded-full" style="width: 67%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-700 dark:text-gray-300">Netzwerke</span>
                                    <span class="text-gray-500 dark:text-gray-400">42%</span>
                                </div>
                                <div class="mt-1 relative pt-1">
                                    <div class="flex mb-2 items-center justify-between">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                            <div class="bg-yellow-600 h-2 rounded-full" style="width: 42%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity History -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Letzte Aktivitäten</h3>
                        
                        <div class="flow-root">
                            <ul class="-mb-8">
                                <li class="relative pb-8">
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                <svg class="h-4 w-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">Übung "Java Grundlagen" <span class="font-medium text-gray-900 dark:text-white">abgeschlossen</span></p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                                                vor 2 Stunden
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li class="relative pb-8">
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                <svg class="h-4 w-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500 dark:text-gray-400"><span class="font-medium text-gray-900 dark:text-white">Neues Thema</span> "Datenstrukturen" gestartet</p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                                                gestern
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li class="relative">
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span class="h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                <svg class="h-4 w-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500 dark:text-gray-400"><span class="font-medium text-gray-900 dark:text-white">Achievement</span> "Erste 100 Fragen" erhalten</p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                                                vor 3 Tagen
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Achievement Badges -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Errungenschaften</h3>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                    </svg>
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Erste Frage</p>
                            </div>
                            <div class="text-center">
                                <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Schneller Lerner</p>
                            </div>
                            <div class="text-center opacity-50">
                                <div class="w-12 h-12 mx-auto mb-2 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                    </svg>
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Streak Meister</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Statistiken</h3>
                        
                        <dl class="space-y-4">
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Gesamte Punkte</dt>
                                <dd class="text-sm font-medium text-gray-900 dark:text-white" th:text="${userStats?.totalPoints ?: 0}">1,247</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Genauigkeitsrate</dt>
                                <dd class="text-sm font-medium text-gray-900 dark:text-white" th:text="${userStats?.accuracyRate ?: 0} + '%'">82.5%</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Längster Streak</dt>
                                <dd class="text-sm font-medium text-gray-900 dark:text-white" th:text="${userStats?.longestStreak ?: 0}">15 Tage</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Rang</dt>
                                <dd class="text-sm font-medium text-gray-900 dark:text-white" th:text="'#' + (${userStats?.rank} ?: '?')'">#23</dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <!-- Study Goals -->
                <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Lernziele</h3>
                            <button class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                Bearbeiten
                            </button>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-blue-800 dark:text-blue-300">Tägliches Ziel</span>
                                    <span class="text-sm text-blue-600 dark:text-blue-400">7/10</span>
                                </div>
                                <div class="w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 70%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-green-800 dark:text-green-300">Wöchentliches Ziel</span>
                                    <span class="text-sm text-green-600 dark:text-green-400">45/50</span>
                                </div>
                                <div class="w-full bg-green-200 dark:bg-green-800 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 90%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <script>
            function profilePicture() {
                return {
                    handleFileUpload(event) {
                        const file = event.target.files[0];
                        if (file) {
                            // TODO: Upload file logic
                            console.log('Uploading profile picture:', file);
                        }
                    }
                }
            }

            function profileForm() {
                return {
                    saving: false,
                    profile: {
                        firstName: '',
                        lastName: '',
                        email: '',
                        phone: '',
                        birthDate: '',
                        location: '',
                        bio: ''
                    },
                    
                    saveProfile() {
                        this.saving = true;
                        
                        // TODO: API call to save profile
                        fetch('/api/profile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer ' + localStorage.getItem('jwt_token')
                            },
                            body: JSON.stringify(this.profile)
                        })
                        .then(response => response.json())
                        .then(data => {
                            // Success handling
                            this.saving = false;
                            this.showSuccessMessage('Profil erfolgreich gespeichert');
                        })
                        .catch(error => {
                            this.saving = false;
                            this.showErrorMessage('Fehler beim Speichern des Profils');
                            console.error('Error:', error);
                        });
                    },
                    
                    showSuccessMessage(message) {
                        // TODO: Show success toast
                        alert(message);
                    },
                    
                    showErrorMessage(message) {
                        // TODO: Show error toast
                        alert(message);
                    }
                }
            }

            // Initialize charts when page loads
            document.addEventListener('DOMContentLoaded', function() {
                // Accuracy Chart
                const accuracyCtx = document.getElementById('accuracyChart');
                new Chart(accuracyCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Richtig', 'Falsch'],
                        datasets: [{
                            data: [82.5, 17.5],
                            backgroundColor: ['#22c55e', '#ef4444'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        cutout: '75%'
                    }
                });

                // Topic Progress Chart
                const topicCtx = document.getElementById('topicProgressChart');
                new Chart(topicCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Java', 'DB', 'Netz', 'Sec'],
                        datasets: [{
                            data: [85, 67, 42, 23],
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            });
        </script>
    </th:block>
</body>
</html>